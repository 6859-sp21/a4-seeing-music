<html>
  <head>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
  </head>
  <body>
    <h1>Bubble</h1>

    <div id="chart" style="width:520px;height:420px;">
      <!-- This is where we will put our chart. -->
    </div>

    <script>
      // Load data from a URL. You can also have the json file downloaded.
      // See https://github.com/d3/d3/blob/master/API.md#fetches-d3-fetch for more options.
      d3.csv("data/data.csv").then((allData) => {
      // Filter top 10 songs
      var topData = allData.sort(function(a, b) {
        return d3.descending(+a.popularity, +b.popularity);
      }).slice(0, 10);
      // Filter year
      const year = 2020;
      const data = topData.filter(d => d.year === year);

      // Setting up variables that describe chart space
      const height = 400;
      const width = 500;
      const margin = ({top: 10, right: 10, bottom: 20, left: 20});

      var diameter = 600;
      var color = d3.scaleOrdinal(d3.schemeCategory10);

      var bubble = d3.pack(data)
          .size([diameter, diameter])
          .padding(1.5);

      var svg = d3.select("body")
          .append("svg")
          .attr("width", diameter)
          .attr("height", diameter)
          .attr("class", "bubble");

      var nodes = d3.hierarchy(data)
          .sum(function(d) { return d.popularity; });

      var node = svg.selectAll(".node")
          .data(bubble(nodes).descendants())
          .enter()
          .filter(function(d){
              return  !d.children
          })
          .append("g")
          .attr("class", "node")
          .attr("transform", function(d) {
              return "translate(" + d.x + "," + d.y + ")";
          });

      // node.append("title")
      //     .text(function(d) {
      //         return d.name + ": " + d.popularity;
      //     });

      // node.append("circle")
      //     .attr("r", function(d) {
      //         return d.r;
      //     })
      //     .style("fill", function(d,i) {
      //         return color(i);
      //     });

      // node.append("text")
      //     .attr("dy", ".2em")
      //     .style("text-anchor", "middle")
      //     .text(function(d) {
      //         return d.data.name.substring(0, d.r / 3);
      //     })
      //     .attr("font-family", "sans-serif")
      //     .attr("font-size", function(d){
      //         return d.r/5;
      //     })
      //     .attr("fill", "white");

      // node.append("text")
      //     .attr("dy", "1.3em")
      //     .style("text-anchor", "middle")
      //     .text(function(d) {
      //         return d.popularity;
      //     })
      //     .attr("font-family",  "Gill Sans", "Gill Sans MT")
      //     .attr("font-size", function(d){
      //         return d.r/5;
      //     })
      //     .attr("fill", "white");

      // d3.select(self.frameElement)
      //     .style("height", diameter + "px");

      document.getElementById("chart").appendChild(svg.node());
      });
  
      </script>
  </body>

  <!-- This adapted from Arvind's observable from lecture. https://observablehq.com/d/4c93c3a516d35624 -->
  <!-- Great D3 intro resource: https://observablehq.com/@d3/learn-d3?collection=@d3/learn-d3 -->
</html>