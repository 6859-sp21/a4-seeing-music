<html>
  <head>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
  </head>
  <body>
    <h1>Justin Bieber</h1>
    <div style="display: flex;">
      <div style="flex: 1">
        <p style = "margin-left: 210; font-size: 25; text-decoration: underline gray; text-decoration-thickness: 0.5px;"> Song Release Dates</p>
        <div id="chart"></div>
      </div>
      <div style="flex: 1">
        <p style = "font-size: 25; text-decoration: underline gray; text-decoration-thickness: 0.5px;"> Justin Bieber's genres</p>
        <div id="charte"></div>
      </div>
    </div>

    <script>
      var margin = {top: 0, right: 30, bottom: 40, left: 210},
        width = 500 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

      // Load data from a URL. You can also have the json file downloaded.
      // See https://github.com/d3/d3/blob/master/API.md#fetches-d3-fetch for more options.
      d3.csv("data/data.csv").then((allData) => {

      // Get Artist Data
      const artist = "['Justin Bieber']";
      const artistData = allData.filter(d => {
        // console.log(d.artists);
        // let artists = d.artists.replace(/[\'[\']/g, '["');
        // artists = d.artists.replace("']", '"]');
        // artists = d.artists.replace("',", '",');
        // console.log(artists)
        // let artistArray = JSON.parse(artists); 
        if (d.artists === artist){
          return d
        }
      });
      
      var svg = d3.select("body")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");
      
      // Add X axis
      var x = d3.scaleTime()
          .domain(d3.extent(artistData, function(d){
            return new Date(d.release_date)
          }))
          .range([ 0, width]);
      svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-10,0)rotate(-45)")
          .style("text-anchor", "end");

      // Y axis
      var y = d3.scaleBand()
          .range([ 0, height ])
          .domain(artistData.map(function(d) { return d.name; }))
          .padding(1);
      svg.append("g")
          .call(d3.axisLeft(y))

      // min line var
      var min = new Date(artistData[0].release_date).getTime();
      for(d in artistData){
        let curr = new Date(d.release_date).getTime();
        if(min > curr){
          min = curr;
        }
      }
      
      // Lines
      svg.selectAll("myline")
          .data(artistData)
          .enter()
          .append("line")
          .attr("x1", function(d) { return x(new Date(d.release_date)); })
          .attr("x2", x(min))
          .attr("y1", function(d) { return y(d.name); })
          .attr("y2", function(d) { return y(d.name); })
          .attr("stroke", "grey")

      // Circles
      svg.selectAll("mycircle")
          .data(artistData)
          .enter()
          .append("circle")
          .attr("cx", function(d) { return x(new Date(d.release_date)); })
          .attr("cy", function(d) { return y(d.name); })
          .attr("r", "7")
          .style("fill", "#69b3a2")
          .attr("stroke", "black")

      document.getElementById("chart").appendChild(svg);

      // append the svg object to the body of the page
      var svg2 = d3.select("body").append("svg2")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

      // Constructs a new cloud layout instance. It run an algorithm to find the position of words that suits your requirements
      // Wordcloud features that are different from one word to the other must be here
      var layout = d3.layout.cloud()
        .size([width, height])
        .words(artistData.map(function(d) { return {text: d.tempo, size:d.tempo}; }))
        .padding(5)        //space between words
        .rotate(function() { return ~~(Math.random() * 2) * 90; })
        .fontSize(function(d) { return d.tempo; })      // font size of words
        .on("end", draw);
      layout.start();

      // This function takes the output of 'layout' above and draw the words
      // Wordcloud features that are THE SAME from one word to the other can be here
      function draw(words) {
        svg2
          .append("g")
            .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
            .selectAll("text")
              .data(words)
            .enter().append("text")
              .style("font-size", function(d) { return d.tempo; })
              .style("fill", "#69b3a2")
              .attr("text-anchor", "middle")
              .style("font-family", "Impact")
              .attr("transform", function(d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function(d) { return d.tempo; });
      }
      document.getElementById("charte").appendChild(svg2);


      });
  
      </script>
  </body>

  <!-- This adapted from Arvind's observable from lecture. https://observablehq.com/d/4c93c3a516d35624 -->
  <!-- Great D3 intro resource: https://observablehq.com/@d3/learn-d3?collection=@d3/learn-d3 -->
</html>